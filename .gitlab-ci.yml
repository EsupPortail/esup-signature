build:
  stage: deploy
  script:
    - set -e
    - mvn clean package -Dspring.config.location=/opt/esup-signature-test-work/application.yml -Djava.io.tmpdir=/opt/esup-signature-test-work/tmp
    - mvn failsafe:integration-test
    - sudo systemctl stop esup-signature-test.service
    - rm -f /opt/esup-signature-test-work/esup-signature.war
    - cp target/esup-signature.war /opt/esup-signature-test-work/
    - sudo systemctl restart esup-signature-test.service
  only:
    - test
  tags:
    - test

build3:
  stage: deploy
  script:
    - mvn clean package -DskipTests -Dspring.config.location=/opt/esup-signature/application.yml
    - sudo systemctl stop esup-signature.service
    - rm -f /opt/esup-signature/esup-signature.war
    - cp target/esup-signature.war /opt/esup-signature/
    - sudo systemctl restart esup-signature.service
  only:
    - tags
  except:
    - dev
    - prod
    - test
    - master
  tags:
    - prod2