<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>
<nav th:replace="fragments/menu :: menu(activeMenu)"></nav>
<nav class="nav justify-content-between" aria-label="breadcrumb">
    <div class="navbar-nav">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/manager/">Liste des parapheurs</a></li>
            <li class="breadcrumb-item active"><span th:text="'Modification de parapheur ' + ${signBook.name}"></span></li>
        </ol>
    </div>
</nav>
<main role="main" class="container">
    <form th:object="${signBook}" th:action="'/manager/signbooks/update/' + ${signBook.id}" method="post">
        <input type="hidden" th:field="*{id}">
        <div class="card card-body bg-light">
            <div class="row">
                <div class="col-lg-12">
                    <div class="form-group" id="_c_org_esupportail_esupsignature_domain_SignRequest_moderatoremails">
                        <label for="moderatoremailsSelect"><strong>Gestionnaire(s) du parapheur</strong>
                            <button class="btn btn-sm btn-light" data-target="#collapseHelp1" data-toggle="collapse" type="button">
                                <span class="fas fa-info-circle text-info"></span>
                            </button>
                            <div class="collapse" id="collapseHelp1">
                                <div class="alert alert-info">
                                    <!--  -->
                                </div>
                            </div>
                        </label>
                        <select id="moderatoremailsSelect" multiple="multiple" name="moderatorEmails">
                            <th:block th:each="moderatorEmail : ${signBook.moderatorEmails}">
                                <option selected="selected" th:value="${moderatorEmail}" th:text="${moderatorEmail}"></option>
                            </th:block>
                        </select>
                        <script type="text/javascript">
                            new SlimSelect({
                                select: '#moderatoremailsSelect',
                                placeholder: 'Choisir un ou plusieurs utilisateurs',
                                searchText: 'Aucun résultat',
                                searchPlaceholder: 'Rechercher',
                                searchHighlight: true,
                                searchFilter: (option, search) => {
                                    return true;
                                },
                                ajax: function (search, callback) {
                                    if (search.length < 3) {
                                        callback('Merci de saisir au moins 3 caractères')
                                        return
                                    }
                                    fetch('/ws/searchLdap?searchString=' + search)
                                        .then(function (response) {
                                            return response.json()
                                        })
                                        .then(function (json) {
                                            let data = []
                                            for (let i = 0; i < json.length; i++) {
                                                data.push({text: json[i].displayName + ' (' + json[i].uid + ')', value: json[i].mail});
                                            }
                                            callback(data)
                                        })
                                        .catch(function (error) {
                                            callback(false)
                                        })
                                }

                            });
                        </script>
                    </div>
                    <div class="form-group">
                        <label for="_sourceType_id">
                            <strong> Protocole pour la source des documents </strong>
                        </label>
                        <select class="form-control" id="_sourceType_id" th:field="*{sourceType}" size="1">
                            <th:block th:each="sourceType : ${sourceTypes}">
                                <option th:if="${signBook.sourceType == sourceType}" selected="selected" th:value="${sourceType}" th:text="${sourceType}"></option>
                                <option th:unless="${signBook.sourceType == sourceType}" value="${sourceType}" th:text="${sourceType}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="form-group" id="_c_org_esupportail_esupsignature_domain_SignBook_documentsSourceUri">
                        <label for="documentsSourceUri"> <strong>Lien pour la source des documents</strong></label>
                        <input id="documentsSourceUri" name="documentsSourceUri" placeholder="Si autre que la valeur par défaut" class="form-control" type="text" value="" autocomplete="on">
                    </div>
                    <div class="form-group" id="c_org_esupportail_esupsignature_domain_SignBook_targetType">
                        <label for="_targetType_id">
                            <strong> Protocole pour la destination des documents </strong>
                        </label>
                        <select class="form-control" id="_targetType_id" th:field="*{targetType}" size="1">
                            <th:block th:each="targetType : ${targetTypes}">
                                <option th:if="${signBook.targetType == targetType}" selected="selected" th:value="${targetType}" th:text="${targetType}"></option>
                                <option th:unless="${signBook.targetType == targetType}" th:value="${targetType}" th:text="${targetType}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="form-group" id="_c_org_esupportail_esupsignature_domain_SignBook_documentsTargetUri">
                        <label for="documentsTargetUri"><strong>Lien pour la destination des documents</strong></label>
                        <input id="documentsTargetUri" name="documentsTargetUri" placeholder="Si autre que la valeur par défaut" class="form-control" type="text" value="" autocomplete="on">
                    </div>
                    <div class="form-group">
                        <label for="inputGroupFile01"><strong> Ajouter un modèle </strong></label>
                        <div class="input-group">
                            <div class="custom-file">
                                <input aria-describedby="inputGroupFileAddon01" class="custom-file-input" data-buttonText="Choisir fichier" id="inputGroupFile01" name="multipartFile" type="file"/>
                                <label class="custom-file-label" for="inputGroupFile01" id="inputGroupLabel01">
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="_c_org_esupportail_esupsignature_domain_SignBook_description"><label for="_description_id" class="col-lg-3  col-form-label"><strong>Description</strong></label>
                        <div class="col-lg-9"><textarea id="_description_id" name="description" class="form-control" rows="5" cols="50"></textarea><br></div>
                    </div>
                    <input type="submit" class="btn btn-success" value="Valider">
                </div>
            </div>
        </div>
    </form>
</main>
<script type="text/javascript">
    var sourceSelector = document.getElementById("_sourceType_id");
    var targetSelector = document.getElementById("_targetType_id");
    var sourceUri = document
        .getElementById("_c_org_esupportail_esupsignature_domain_SignBook_documentsSourceUri");
    var targetUri = document
        .getElementById("_c_org_esupportail_esupsignature_domain_SignBook_documentsTargetUri");
    if (sourceUri.value == "") {
        sourceUri.style.display = "none";
    }
    if (targetUri.value == "") {
        targetUri.style.display = "none";
    }
    sourceSelector.onchange = function () {
        if (sourceSelector.value != "none") {
            sourceUri.style.display = "block";
        } else {
            sourceUri.style.display = "none";
        }
    };
    targetSelector.onchange = function () {
        if (targetSelector.value != "none") {
            targetUri.style.display = "block";
        } else {
            targetUri.style.display = "none";
        }
    };


    new SlimSelect({
        select: '#moderatoremailsSelect',
        placeholder: 'Choisir un ou plusieurs utilisateurs',
        searchText: 'Aucun résultat',
        searchPlaceholder: 'Rechercher',
        searchHighlight: true,
        searchFilter: (option, search) => {
            return true;
        },
        ajax: function (search, callback) {
            if (search.length < 3) {
                callback('Merci de saisir au moins 3 caractères')
                return
            }
            fetch('/user/users/searchLdap?searchString=' + search)
                .then(function (response) {
                    return response.json()
                })
                .then(function (json) {
                    let data = []
                    for (let i = 0; i < json.length; i++) {
                        data.push({text: json[i].displayName, value: json[i].mail});
                    }
                    callback(data)
                })
                .catch(function (error) {
                    callback(false)
                })
        }

    });
</script>
</body>
</html>