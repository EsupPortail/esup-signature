<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>
<nav th:replace="fragments/nav :: nav(activeNav)"></nav>
<main role="main">
    <div class="wrapper">
        <div th:replace="fragments/side :: side"></div>
        <div class="content">
            <nav th:replace="fragments/breadcrumb :: breadcrumb"></nav>
            <div id="ribbon" class="card">
                <div class="card-header">
                    <button type="button" class="btn btn-light btn-outline-dark float-left"
                            value="Retour" onclick="window.history.back();">
                        <i class="fas fa-times fa-2x"></i><br/>Abandonner
                    </button>
                    <button type="button"
                            onclick="document.getElementById('updateDataSubmit').click();"
                            class="btn btn-success float-right">
                        <i class="far fa-save fa-2x"></i><br/> Enregistrer
                    </button>
                </div>
                <div class="card-body container">
                    <div th:if="${document != null}" class="container-fluid">
                        <form id="updateData" th:action="'/user/' + ${user.eppn} + '/data/' + ${data.id}" th:method="put">
                            <input type="hidden" name="page" th:value="${page}">
                            <input type="hidden" id="navPage" name="navPage">
                            <div th:if="${page > 1}" class="row alert alert-secondary">
                                <div class="col-lg-1">
                                    <a th:classappend="${page < 2} ? 'disabled'" class="btn btn-light btn-outline-dark" onclick="nav('prev')">
                                        <i class="fas fa-arrow-left"></i>
                                    </a>
                                </div>
                                <div class="col-lg-10 text-center">
                                    <span th:text="'Page ' + ${page} + '/' + ${form.nbPages}"></span>
                                </div>
                                <div class="col-lg-1">
                                    <a th:classappend="${page >= form.nbPages} ? 'disabled'" class="btn btn-light btn-outline-dark float-right" id="next" onclick="nav('next')">
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>

                            <input id="updateDataSubmit" type="submit" style="display: none;"/>
                            <div class="form-group ">
                                <label for="name"><b>Nom du document :</b></label>
                                <input id="name" class="form-control" type="text" name="name" th:value="${data.name}" required/>
                            </div>
                            <div id="pointer_div" th:style="${form.pdfDisplay} ? 'position: relative;background-repeat: no-repeat; background-size: ' + ${pdfParameters.width * 2} + 'px; background-image:url(\'/user/document/' + ${document.id} + '/getimagepdfpage/'+ ${page -1} +'\');width: ' + ${pdfParameters.width * 2} + 'px;height: 1684px;border:1px solid #CCC;'">
                                <th:block th:each="field : ${fields}">
                                    <div th:switch="${#strings.toString(field.type)}">
                                        <input th:required="${field.required}" th:value="${data.datas.get(field.name)}" th:case="'text'" type="text" class="form-control" th:name="${field.name}" th:placeholder="${field.label}"
                                               th:style="'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2 + 3} + 'px; top : ' + ${1685 - field.topPos * 2} + 'px;'"/>
                                        <div class="form-group" th:case="'date'">
                                            <label th:if="${!form.pdfDisplay}" th:for="${field.name}" th:text="${field.label}"></label>
                                            <input th:required="${field.required}" autocomplete="off" th:value="${data.datas.get(field.name)}" type="text"
                                                   class="form-control datepicker" th:name="${field.name}"
                                                   th:placeholder="${form.pdfDisplay} ? ${field.label}"
                                                   th:style="${form.pdfDisplay} ? 'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2 + 3} + 'px; top : ' + ${1685 - field.topPos * 2} + 'px;'"/>
                                        </div>
                                        <div class="form-group" th:case="'time'">
                                            <label th:if="${!form.pdfDisplay}" th:for="${field.name}" th:text="${field.label}"></label>
                                            <input th:required="${field.required}" autocomplete="off" th:value="${data.datas.get(field.name)}" type="text"
                                                   class="form-control timepicker" th:name="${field.name}"
                                                   th:placeholder="${form.pdfDisplay} ? ${field.label}"
                                                   th:style="${form.pdfDisplay} ? 'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2 + 3} + 'px; top : ' + ${1685 - field.topPos * 2} + 'px;'"/>
                                        </div>
                                        <div class="form-group" th:case="'checkbox'">
                                            <input th:if="${data.datas.get(field.name) == 'on'}" type="checkbox" th:name="${field.name}"
                                                   th:placeholder="${field.name}"
                                                   th:style="${form.pdfDisplay} ? 'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2 + 3} + 'px; top : ' + ${1685 - field.topPos * 2} + 'px;'"
                                                   checked="checked"/>
                                            <input th:unless="${data.datas.get(field.name) == 'on'}" type="checkbox" th:name="${field.name}"
                                                   th:placeholder="${field.name}"
                                                   th:style="${form.pdfDisplay} ? 'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2 + 3} + 'px; top : ' + ${1685 - field.topPos * 2} + 'px;'"/>
                                            <label th:if="${!form.pdfDisplay}" class="form-check-label"
                                                   th:for="${field.name}" th:text="${field.label}"></label>
                                        </div>
                                        <div class="form-group" th:case="'radio'">
                                            <input th:value="${field.label}"
                                                   th:if="${data.datas.get(field.name) == field.label}" type="radio" th:name="${field.name}"
                                                   th:placeholder="${field.name}"
                                                   th:style="${form.pdfDisplay} ? 'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2 + 3} + 'px; top : ' + ${1685 - field.topPos * 2} + 'px;'"
                                                   checked/>
                                            <input th:unless="${data.datas.get(field.name) == field.label}" type="radio" th:name="${field.name}"
                                                   th:value="${field.label}"
                                                   th:placeholder="${field.name}"
                                                   th:style="${form.pdfDisplay} ? 'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2 + 3} + 'px; top : ' + ${1685 - field.topPos * 2} + 'px;'"/>
                                            <label th:if="${!form.pdfDisplay}" class="form-check-label" th:for="${field.name}" th:text="${field.label}"></label>
                                        </div>
                                    </div>
                                </th:block>
                            </div>
                            <div th:if="${document == null}">
                                <th:block th:each="field : ${fields}">
                                    <div class="form-group">
                                        <div th:switch="${#strings.toString(field.type)}">
                                            <div class="form-group" th:case="'checkbox'">
                                                <input th:if="${data.datas.get(field.name) == 'on'}" type="checkbox" th:name="${field.name}"
                                                       th:placeholder="${field.name}"
                                                       th:style="${form.pdfDisplay} ? 'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2} + 'px; top : ' + ${1684 - field.topPos * 2} + 'px;'"
                                                       checked="checked"/>
                                                <input th:unless="${data.datas.get(field.name) == 'on'}" type="checkbox" th:name="${field.name}"
                                                       th:placeholder="${field.name}"
                                                       th:style="${form.pdfDisplay} ? 'position: absolute; width : ' + ${field.width * 2} + 'px; height : ' + ${field.height * 2} + 'px; left : ' + ${field.leftPos * 2} + 'px; top : ' + ${1684 - field.topPos * 2} + 'px;'"/>
                                                <label th:if="${!form.pdfDisplay}" class="form-check-label"
                                                       th:for="${field.name}" th:text="${field.label}"></label>
                                            </div>
                                            <input th:value="${data.datas.get(field.name)}" th:case="'text'" type="text" class="form-control" th:name="${field.name}" th:placeholder="${field.label}"/>
                                        </div>
                                    </div>
                                </th:block>
                            </div>
                            <div class="row alert alert-secondary">
                                <div class="col-lg-1">
                                    <a th:classappend="${page < 2} ? 'disabled'" class="btn btn-light btn-outline-dark" onclick="nav('prev')">
                                        <i class="fas fa-arrow-left"></i>
                                    </a>
                                </div>
                                <div class="col-lg-10 text-center">
                                    <span th:text="'Page ' + ${page} + '/' + ${form.nbPages}"></span>
                                </div>
                                <div class="col-lg-1">
                                    <a th:classappend="${page >= form.nbPages} ? 'disabled'" class="btn btn-light btn-outline-dark float-right" id="next" onclick="nav('next')">
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                            <button type="button"
                                    onclick="document.getElementById('updateDataSubmit').click();"
                                    class="btn btn-success float-right">
                                <i class="far fa-save fa-1x"></i> Enregistrer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<footer th:replace="fragments/footer :: footer"></footer>
<script language="JavaScript">
    function nav(navPage) {
        document.getElementById("navPage").value = navPage;
        document.getElementById("updateData").submit();
    }
</script>
</body>
</html>
