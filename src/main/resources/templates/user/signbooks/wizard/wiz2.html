<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>
<div id="stepper1" class="bs-stepper linear">
    <div class="bs-stepper-header" role="tablist">
        <div class="step" data-target="#test-l-1">
            <span class="bs-stepper-circle bg-success"><i class="fa fa-magic"></i></span>
            <span class="bs-stepper-label">Nom</span>
        </div>
        <div class="bs-stepper-line"></div>
        <div class="step active" data-target="#test-l-2">
            <span class="bs-stepper-circle"><i class="fa fa-copy"></i></span>
            <span class="bs-stepper-label">Copie des fichiers</span>
        </div>
        <div class="bs-stepper-line"></div>
        <div class="step" data-target="#test-l-3">
            <span class="bs-stepper-circle"><i class="fa fa-project-diagram"></i></span>
            <span class="bs-stepper-label">Création du circuit</span>
        </div>
        <div class="bs-stepper-line"></div>
        <div class="step" data-target="#test-l-3">
            <span class="bs-stepper-circle"><i class="fa fa-save"></i></span>
            <span class="bs-stepper-label">Sauvegarde</span>
        </div>
        <div class="bs-stepper-line"></div>
        <div class="step" data-target="#test-l-3">
            <span class="bs-stepper-circle"><i class="fa fa-flag-checkered"></i></span>
            <span class="bs-stepper-label">Fin</span>
        </div>
    </div>
</div>
<h4 class="d-flex justify-content-center mt-4">Dépot des fichiers</h4>
<form id="wiz2Form" th:action="'/user/signbooks/wizard/wiz3'" method="post">
    <input type="hidden" name="name" th:value="${name}">
    <input th:if="${workflow != null}" type="hidden" name="workflowId" th:value="${workflow.id}">
    <div class="col-lg-12">
        <div class="file-loading">
            <input id="multipartFile" name="multipartFiles" type="file" multiple="multiple"/>
        </div>
        <div id="unique" class="form-check d-none">
            <label>Regrouper les documents dans une archive lors de la signature</label>
            <label class="switch">
                <input type="checkbox" name="unique">
                <span class="slider round"></span>
            </label>
        </div>
    </div>
    <button type="button" onclick="window.history.back();" class="btn btn-success" style="position: absolute;left: 10px;bottom: 10px;">
        <i class="fas fa-angle-left"></i> Précédent
    </button>
    <button type="button" onclick="fileUpload();" class="btn btn-success" style="position: absolute;right: 10px;bottom: 10px;">
        Suivant <i class="fas fa-angle-right"></i>
    </button>
    <script>
        /*<![CDATA[*/
        function fileUpload() {
            $('#multipartFile').fileinput('upload');
        }

        $('#unique :checkbox').change(function () {
            console.log('change');
            if ($('#unique :checkbox').is(":checked")){
                $('#multipartFile').fileinput('refresh', {
                    uploadUrl: '[['/ws/add-docs-in-sign-book-group/' + ${name} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]]'
                });
            } else {
                console.log('uncheck');
                $('#multipartFile').fileinput('refresh', {
                    uploadUrl: '[['/ws/add-docs-in-sign-book-unique/' + ${name} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]]'
                });
            }
            }
        );

        $("#multipartFile").fileinput({
            language: "fr",
            showCaption: false,
            showClose: false,
            showBrowse: true,
            showUpload: false,
            uploadUrl: '[['/ws/add-docs-in-sign-book-unique/' + ${name} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]]',
            showRemove: false,
            browseOnZoneClick: true,
            uploadAsync: false,
            overwriteInitial: false,
            theme: 'explorer-fas',
            pdfRendererUrl: 'http://plugins.krajee.com/pdfjs/web/viewer.html',
            preferIconicPreview: true,
            previewFileIconSettings: { // configure your icon file extensions
                'doc': '<i class="fas fa-file-word text-primary fa-2x"></i>',
                'xls': '<i class="fas fa-file-excel text-success fa-2x"></i>',
                'ppt': '<i class="fas fa-file-powerpoint text-danger fa-2x"></i>',
                'pdf': '<i class="fas fa-file-pdf text-danger fa-2x"></i>',
                'zip': '<i class="fas fa-file-archive text-muted fa-2x"></i>',
                'htm': '<i class="fas fa-file-code text-info fa-2x"></i>',
                'txt': '<i class="fas fa-file-alt text-info fa-2x"></i>',
                'mov': '<i class="fas fa-file-video text-warning fa-2x"></i>',
                'mp3': '<i class="fas fa-file-audio text-warning fa-2x"></i>',
                'jpg': '<i class="fas fa-file-image text-danger fa-2x"></i>',
                'gif': '<i class="fas fa-file-image text-muted fa-2x"></i>',
                'png': '<i class="fas fa-file-image text-primary fa-2x"></i>'
            },
            previewFileExtSettings: {
                'doc': function(ext) {
                    return ext.match(/(doc|docx|odt)$/i);
                },
                'xls': function(ext) {
                    return ext.match(/(xls|xlsx)$/i);
                },
                'ppt': function(ext) {
                    return ext.match(/(ppt|pptx)$/i);
                }
            }
        });

        $('#multipartFile').on('filebatchuploadsuccess', function(event, previewId, index, fileId) {
            $('#wiz2Form').submit();
        });

        $('#multipartFile').on('fileloaded', function(event, file, previewId, index, reader) {
            if($('#multipartFile').fileinput('getFilesCount') > 1) {
                $('#unique').removeClass('d-none');
            } else {
                $('#unique').addClass('d-none');
            }

        });

        /*]]>*/
    </script>
</form>
</body>
</html>
