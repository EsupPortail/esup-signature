<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>
<div class="alert alert-info">Ajouter les documents au parapheur</div>
<form id="wiz2Form" th:action="'/user/signbooks/wizard/wiz3'" method="post">
    <input type="hidden" name="name" th:value="${name}">
    <div class="col-lg-12">
        <div class="file-loading">
            <input id="multipartFile" name="multipartFiles" type="file" multiple="multiple"/>
        </div>
        <div id="unique" class="form-check d-none">
            <label>Regrouper les documents dans une archive lors de la signature</label>
            <label class="switch">
                <input type="checkbox" name="unique">
                <span class="slider round"></span>
            </label>
        </div>
    </div>
    <button type="button" onclick="fileUpload();" id="register-form-submit" class="btn btn-success" style="position: absolute;right: 10px;bottom: 10px;">
        Suivant <i class="fas fa-angle-right"></i>
    </button>
    <script>
        /*<![CDATA[*/
        function fileUpload() {
            $('#multipartFile').fileinput('upload');
        }

        $('#unique :checkbox').change(function () {
            console.log('change');
            if ($('#unique :checkbox').is(":checked")){
                $('#multipartFile').fileinput('refresh', {
                    uploadUrl: '[['/user/signbooks/add-doc/' + ${name} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]]'
                });
            } else {
                console.log('uncheck');
                $('#multipartFile').fileinput('refresh', {
                    uploadUrl: '[['/user/signbooks/add-doc-new-signrequest/' + ${name} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]]'
                });
            }
            }
        );

        $("#multipartFile").fileinput({
            language: "fr",
            showCaption: false,
            showClose: false,
            showBrowse: true,
            showUpload: false,
            uploadUrl: '[['/user/signbooks/add-doc-new-signrequest/' + ${name} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]]',
            showRemove: false,
            browseOnZoneClick: true,
            uploadAsync: false,
            overwriteInitial: false,
            theme: 'explorer-fas',
            pdfRendererUrl: 'http://plugins.krajee.com/pdfjs/web/viewer.html',
            preferIconicPreview: true,
            previewFileIconSettings: { // configure your icon file extensions
                'doc': '<i class="fas fa-file-word text-primary  fa-2x"></i>',
                'xls': '<i class="fas fa-file-excel text-success  fa-2x"></i>',
                'ppt': '<i class="fas fa-file-powerpoint text-danger  fa-2x"></i>',
                'pdf': '<i class="fas fa-file-pdf text-danger  fa-2x"></i>',
                'zip': '<i class="fas fa-file-archive text-muted  fa-2x"></i>',
                'htm': '<i class="fas fa-file-code text-info  fa-2x"></i>',
                'txt': '<i class="fas fa-file-alt text-info fa-2x"></i>',
                'mov': '<i class="fas fa-file-video text-warning fa-2x"></i>',
                'mp3': '<i class="fas fa-file-audio text-warning  fa-2x"></i>',
                'jpg': '<i class="fas fa-file-image text-danger fa-2x"></i>',
                'gif': '<i class="fas fa-file-image text-muted fa-2x"></i>',
                'png': '<i class="fas fa-file-image text-primary fa-2x"></i>'
            },

        });

        $('#multipartFile').on('filebatchuploadsuccess', function(event, previewId, index, fileId) {
            $('#wiz2Form').submit();
        });

        $('#multipartFile').on('fileloaded', function(event, file, previewId, index, reader) {
            if($('#multipartFile').fileinput('getFilesCount') > 1) {
                $('#unique').removeClass('d-none');
            } else {
                $('#unique').addClass('d-none');
            }

        });

        /*]]>*/
    </script>
</form>
</body>
</html>
