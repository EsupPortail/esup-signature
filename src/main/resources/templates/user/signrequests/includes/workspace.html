<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<!--/*@thymesVar id="signRequest" type="org.esupportail.esupsignature.entity.SignRequest"*/-->
<!--/*@thymesVar id="signRequestParams" type="org.esupportail.esupsignature.entity.SignRequestParams"*/-->
<!--/*@thymesVar id="comments" type="java.util.List<org.esupportail.esupsignature.entity.Log>"*/-->
<div th:fragment="workspace" id="workspace" class="alert justify-content-center" th:classappend="(${nbSignRequestInSignBookParent > 1} ? 'workspace-sign' : 'workspace-pdf') + ' ' + (${signable && signRequest.status != T(org.esupportail.esupsignature.entity.enums.SignRequestStatus).signed}? 'alert-secondary' : 'alert-success')">
    <form th:id="'signForm'" th:action="''">
        <input id="checkDataSubmit" type="submit" style="display: none;"/>
        <div id="pdf" class="drop-shadows mx-auto">
            <th:block th:if="${signable && signRequest.status != T(org.esupportail.esupsignature.entity.enums.SignRequestStatus).signed}">
                <div id="cross_0" ontouchstart="this.style.backgroundColor= 'rgba(0, 255, 0, .5)';" class="bgfilter"
                     onmouseover="this.style.backgroundColor= 'rgba(0, 255, 0, .5)';"
                     onmouseout="this.style.backgroundColor= 'rgba(0, 0, 0, .0)';"
                     style="display: none;z-index:4;pointer-events: auto;cursor: move;background-repeat: no-repeat; background-position: left bottom;">
                    <div id="crossTools_0" class="badge badge-success position-absolute d-none" style="left: 0px; top: -45px;
                        z-index: 3; opacity: .9;user-select: none;
                        -moz-user-select: none;
                        -khtml-user-select: none;
                        -webkit-user-select: none;
                        -o-user-select: none;">
                        <button type="button" id="signZoomOut_0"
                                class="btn btn-sm btn-transparent text-white"
                                style="z-index: 3;">
                            <span style="font-size:1em; line-height: 1em;" class="">A</span>
                        </button>
                        <button type="button" id="signZoomIn_0"
                                class="btn btn-sm btn-transparent text-white"
                                style="z-index: 3;">
                            <span style="font-size:1.6666em; line-height: 1em;">A</span>
                        </button>
                        <button type="button" id="signPrevImage_0"
                                class="btn btn-sm btn-transparent text-white"
                                style="z-index: 3;">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <button type="button" id="signNextImage_0"
                                class="btn btn-sm btn-transparent text-white"
                                style="z-index: 3;">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <button type="button" id="signExtra_0"
                                class="btn btn-sm btn-transparent text-white"
                                style="z-index: 3;">
                            <i class="fas fa-receipt"></i>
                        </button>
                        <button type="button" id="signExtraOnTop_0"
                                class="btn btn-sm btn-transparent text-white"
                                style="z-index: 3;">
                            <i class="fas fa-retweet"></i>
                        </button>
                        <button type="button" id="signDrop_0"
                                class="btn btn-sm btn-transparent text-white"
                                style="z-index: 3;">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        <input id="signColorPicker_0" value='#000000'/>
                    </div>
                    <div id="borders_0" class="anim-border"
                         th:style="'text-align:left;line-height:normal;width: ' + ${signWidth} + 'px; height: ' + ${signHeight} + 'px;'"></div>
                </div>
            </th:block>
            <th:block th:each="comment : ${comments}">
                <div th:id="'inDocComment_' + ${comment.id}" class="circle"
                     th:onmouseover="'$(\'#postit' + ${comment.id} + '\').addClass(\'circle-border\');'"
                     th:onmouseout="'$(\'#postit' + ${comment.id} + '\').removeClass(\'circle-border\');'">
                    <i class="fas fa-comment fa-3x"></i>
                </div>
            </th:block>
            <th:block th:each="signRequestParams,iterator : ${signRequest.signRequestParams}">
                <div th:id="'inDocSpot_' + ${signRequestParams.id}" class="spot"
                     th:onmouseover="'$(\'#liveStep-' + ${iterator.index + 1} + '\').toggleClass(\'bg-white bg-success\');'"
                     th:onmouseout="'$(\'#liveStep-' + ${iterator.index + 1} + '\').toggleClass(\'bg-white bg-success\');'">
                    <i class="fas fa-map-marker-alt fa-3x"></i>
                </div>
            </th:block>
            <div id="postit" class="postit badge badge-warning">
                <input id="commentPosX" name="commentPosX" type="hidden"/>
                <input id="commentPosY" name="commentPosY" type="hidden"/>
                <input id="commentPageNumber" name="commentPageNumber" type="hidden"/>
                <div class="form-check float-left text-left" style="margin-top: 15px;" th:with="stepNumber = ${signRequest.signRequestParams.size() + 1}"
                    th:if="${signRequest.signRequestParams.size() + 1 <= signRequest.parentSignBook.liveWorkflow.liveWorkflowSteps.size()}">
                    <label for="addSignParams">
                        Ajouter un emplacement <br> de signature ici pour l'étape <span th:text="${stepNumber}"></span>
                    </label>
                    <label class="switch">
                        <input id="addSignParams" name="addSignParams" type="checkbox" th:data-target="${stepNumber}"/>
                        <span class="slider round"></span>
                    </label>
                </div>
                <textarea id="postitComment" name="comment" class="postitarea float-left" placeholder="Saisir un commentaire"></textarea>
                <button id="hideCommentButton" type="button" class="btn btn-sm btn-outline-dark float-left">
                    <i class="fas fa-times"></i>
                </button>
                <button id="saveCommentButton" type="button" class="btn btn-sm btn-outline-dark float-right">
                    <i class="fas fa-save"></i>
                </button>
            </div>
        </div>
    </form>

    <div id="commentsTools" th:if="${toSignDocument.contentType == 'application/pdf'}" style="position: fixed; display: none; width: 250px; left: 285px;">
        <div th:unless="${comments.size() > 0}" class="alert alert-light border-dark text-dark">
            Vous pouvez ajouter des commentaires ou des emplacements de signature en cliquant directement sur l’endroit concerné du document
        </div>
        <div th:if="${comments.size() > 0}" class="alert alert-light border-dark text-dark">
            <h5>Commentaires</h5>
            <ul class="list-group">
                <th:block th:each="comment, iterator : ${comments}">
                    <li th:id="'postit' + ${comment.id}" class="list-group-item mb-1" style="position: relative;user-select: none;-moz-user-select: none;-khtml-user-select: none;-webkit-user-select: none;-o-user-select: none;cursor: pointer">
                        <b th:text="${comment.user.firstname + ' ' + comment.user.name}"></b>
                        <p th:text="${#dates.format(comment.logDate, 'dd/MM/yyyy HH:mm')}"></p>
                        <p class="postitarea" th:text="${comment.comment}"></p>
                    </li>
                </th:block>
            </ul>
        </div>
    </div>
</div>
