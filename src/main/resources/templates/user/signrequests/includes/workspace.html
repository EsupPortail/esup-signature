<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--/*@thymesVar id="signRequest" type="org.esupportail.esupsignature.entity.SignRequest"*/-->
<!--/*@thymesVar id="signRequestParams" type="org.esupportail.esupsignature.entity.SignRequestParams"*/-->
<!--/*@thymesVar id="postit" type="org.esupportail.esupsignature.entity.Log"*/-->
<div th:fragment="workspace" id="workspace" class="alert alert-secondary justify-content-center" th:classappend="${signRequest.parentSignBook != null && signRequest.parentSignBook.signRequests.size() > 1} ? 'workspace-sign' : 'workspace'">
    <form id="signForm" th:action="'/user/signrequests/comment/' + ${signRequest.id}" method="post">
        <input id="checkDataSubmit" type="submit" style="display: none;"/>
        <div id="pdf" class="drop-shadows mx-auto">
            <th:block th:if="${signRequest.signable && signRequest.status.name() != 'signed'}">
                <th:block th:if="${currentSignType != 'visa'}">
                    <div id="cross" ontouchstart="this.style.backgroundColor= 'rgba(0, 255, 0, .5)';"
                         onmouseover="this.style.backgroundColor= 'rgba(0, 255, 0, .5)';"
                         onmouseout="this.style.backgroundColor= 'rgba(255, 0, 0, .0)';"
                         th:style="'display: none;background-repeat: no-repeat; background-position: left bottom; background-size: ' + ${signWidth} + 'px;background-image: url(\'data:image/png;base64,' + ${signFile} + '\'); width: ' + ${signWidth} + 'px; height: ' + ${signHeight} + 'px; line-height: ' + ${signHeight} + 'px; text-align: center;  left: ' + ${signRequest.getCurrentSignRequestParams().xPos} + 'px;top: ' + ${signRequest.getCurrentSignRequestParams().yPos} + 'px;position:absolute;pointer-events: auto;cursor: move;'">
                        <div id="borders" class="anim-border" th:style="'text-align:left;line-height:normal;width: ' + ${signWidth} + 'px; height: ' + ${signHeight} + 'px;'"></div>
                    </div>
                </th:block>
                <th:block th:if="${currentSignType == 'visa'}">
                    <div id="cross" ontouchstart="this.style.backgroundColor= 'rgba(0, 255, 0, .5)';"
                         onmouseover="this.style.backgroundColor= 'rgba(0, 255, 0, .5)';"
                         onmouseout="this.style.backgroundColor= 'rgba(255, 0, 0, .0)';"
                         th:style="'display: none;background-repeat: no-repeat; background-position: left bottom; background-size: 100px;background-image: url(\'/images/sceau.png\'); width: 100px; height: 75px; line-height: 75px; text-align: center; left: ' + ${signRequest.getCurrentSignRequestParams().xPos} + 'px;top: ' + ${signRequest.getCurrentSignRequestParams().yPos} + 'px;position:absolute;pointer-events: auto;cursor: move;'">
                        <div id="borders" class="anim-border" th:style="'vertical-align:top; text-align:left;line-height:6px; width:  ' + ${signWidth} + 'px; height:  ' + ${signHeight} + 'px;'">
                            <span id="textVisa" style="font-size: 8px; line-height: normal; font-weight: bold" th:text="'Visé par ' + ${user.firstname} + ' ' + ${user.name}"></span>
                            <br>
                        </div>
                    </div>
                </th:block>
            </th:block>
            <th:block th:if="${signRequest.status.name() == 'pending'}" th:each="postit : ${postits}">
                <div th:if="${postit.finalStatus == 'checked'}" class="postitVisa" th:style="'z-index : 1; position: absolute; left: ' + ${postit.posX} + 'px; top : ' + ${postit.posY} + 'px;'">
                    <b th:text="'Visé par ' + ${@userService.getUserByEppn(postit.eppn).firstname + ' ' + @userService.getUserByEppn(postit.eppn).name}"></b>
                    <p th:text="'le ' + ${#dates.format(postit.logDate, 'dd/MM/yyyy HH:mm')}"></p>
                    <p class="postitarea" th:text="${postit.comment}"></p>
                </div>
            </th:block>
            <th:block th:each="postit : ${postits}">
                <div th:id="${postit.id}" class="circle" th:onmouseover="'$(\'#postit' + ${postit.id} + '\').addClass(\'circle-border\');'" th:onmouseout="'$(\'#postit' + ${postit.id} + '\').removeClass(\'circle-border\');'">
                    <i class="fas fa-comment fa-3x"></i>
                </div>
            </th:block>
        </div>

        <div id="postit" class="postit" style="display: none;position: absolute;left: 0px;top: 0px;z-index: 2;">
            <span id="hideComment" class="float-right" style="cursor: pointer;">X</span>
            <textarea id="comment" name="comment" class="postitarea" placeholder="Saisir une annotation"></textarea>
            <button type="submit" class="btn btn-sm float-right">
                <i class="fas fa-save"></i>
            </button>
        </div>

    </form>
</div>
