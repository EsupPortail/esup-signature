<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<script th:fragment="scriptshow" th:inline="javascript">
    /*<![CDATA[*/

    $('#multipartFile').on('filebatchuploadcomplete', function(event, file, previewId, index, reader) {
        location.reload();
    });
    $('#multipartFile').on('fileuploaded', function(event, file, previewId, index, reader) {
        location.reload();
    });

    $('#multipartFile').on('fileloaded', function(event, file, previewId, index, reader) {
        $('#multipartFile').fileinput('upload');
    });

    $('#multipartFile').on('filedeleted', function(event, id, index) {
        location.reload();
    });

    $("#multipartFile").fileinput({
        language: "fr",
        showCaption: false,
        showClose: false,
        showBrowse: false,
        [# th:if="${signRequest.status.name() != 'draft' || user.eppn != signRequest.createBy || signRequest.signedDocuments.size() > 0}"]
    showUpload: false,
        showRemove: false,
        dropZoneEnabled: false,
        [/]
            [# th:if="${signRequest.status.name() == 'draft' && user.eppn == signRequest.createBy && signRequest.signedDocuments.size() == 0}"]
    browseOnZoneClick: true,
        [/]
            uploadUrl: [['/ws/add-docs/' + ${id} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]],
        uploadAsync: false,
        overwriteInitial: false,
        theme: 'explorer-fas',
        pdfRendererUrl: 'http://plugins.krajee.com/pdfjs/web/viewer.html',
        initialPreview: [
        [# th:each="originalDocument : ${signRequest.originalDocuments}"]
        '/user/documents/getfile/[[${originalDocument.id}]]',
        [/]
        ],
        initialPreviewConfig: [
        [# th:each="originalDocument : ${signRequest.originalDocuments}"]
    [# th:switch="${#strings.arraySplit(originalDocument.contentType, '/')[1]}"]
        [# th:case="'gif'"]
    {type: "image", size: [[${originalDocument.size}]], downloadUrl: "/user/documents/getfile/[[${originalDocument.id}]]",caption: [[${originalDocument.fileName}]], filename: [[${originalDocument.fileName}]], url: [['/user/signrequests/remove-doc/' + ${originalDocument.id} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]], key: [[${originalDocument.id}]]},
        [/]
            [# th:case="'pdf'"]
    {type: "pdf", size: [[${originalDocument.size}]], downloadUrl: "/user/documents/getfile/[[${originalDocument.id}]]",caption: [[${originalDocument.fileName}]], filename: [[${originalDocument.fileName}]], url: [['/user/signrequests/remove-doc/' + ${originalDocument.id} + '?' + ${_csrf.parameterName} + '=' + ${_csrf.token}]], key: [[${originalDocument.id}]]},
        [/]
            [# th:case="'doc'"]
    {type: "office", size: [[${originalDocument.size}]], downloadUrl: "/user/documents/getfile/[[${originalDocument.id}]]",caption: [[${originalDocument.fileName}]], filename: [[${originalDocument.fileName}]], url: [['/user/signrequests/remove-doc/' + ${originalDocument.id}]], key: [[${originalDocument.id}]]},
        [/]
            [# th:case="'avi'"]
    {type: "video", size: [[${originalDocument.size}]], downloadUrl: "/user/documents/getfile/[[${originalDocument.id}]]",caption: [[${originalDocument.fileName}]], filename: [[${originalDocument.fileName}]], url: [['/user/signrequests/remove-doc/' + ${originalDocument.id}]], key: [[${originalDocument.id}]]},
        [/]
            [# th:case="*"]
    {type: "other", size: [[${originalDocument.size}]], downloadUrl: "/user/documents/getfile/[[${originalDocument.id}]]",caption: [[${originalDocument.fileName}]], filename: [[${originalDocument.fileName}]], url: [['/user/signrequests/remove-doc/' + ${originalDocument.id}]], key: [[${originalDocument.id}]]},
        [/]
            [/]
            [/]
            ],
            initialPreviewAsData: true,
            initialPreviewFileType: 'pdf',
            preferIconicPreview: true,
            previewFileIconSettings: { // configure your icon file extensions
            'doc': '<i class="fas fa-file-word text-primary  fa-2x"></i>',
            'xls': '<i class="fas fa-file-excel text-success  fa-2x"></i>',
            'ppt': '<i class="fas fa-file-powerpoint text-danger  fa-2x"></i>',
            'pdf': '<i class="fas fa-file-pdf text-danger  fa-2x"></i>',
            'zip': '<i class="fas fa-file-archive text-muted  fa-2x"></i>',
            'htm': '<i class="fas fa-file-code text-info  fa-2x"></i>',
            'txt': '<i class="fas fa-file-alt text-info fa-2x"></i>',
            'mov': '<i class="fas fa-file-video text-warning fa-2x"></i>',
            'mp3': '<i class="fas fa-file-audio text-warning  fa-2x"></i>',
            'jpg': '<i class="fas fa-file-image text-danger fa-2x"></i>',
            'gif': '<i class="fas fa-file-image text-muted fa-2x"></i>',
            'png': '<i class="fas fa-file-image text-primary fa-2x"></i>'
    },
        previewFileExtSettings: { // configure the logic for determining icon file extensions
            'doc': function(ext) {
                return ext.match(/(doc|docx)$/i);
            },
            'xls': function(ext) {
                return ext.match(/(xls|xlsx)$/i);
            },
            'ppt': function(ext) {
                return ext.match(/(ppt|pptx)$/i);
            },
            'zip': function(ext) {
                return ext.match(/(zip|rar|tar|gzip|gz|7z)$/i);
            },
            'htm': function(ext) {
                return ext.match(/(htm|html)$/i);
            },
            'txt': function(ext) {
                return ext.match(/(txt|ini|csv|java|php|js|css)$/i);
            },
            'mov': function(ext) {
                return ext.match(/(avi|mpg|mkv|mov|mp4|3gp|webm|wmv)$/i);
            },
            'mp3': function(ext) {
                return ext.match(/(mp3|wav)$/i);
            }
        },
        fileActionSettings: {
            showDrag: false,
                showZoom: function(config) {
                if (config.type === 'pdf' || config.type === 'image') {
                    return true;
                }
                return false;
            },
            [# th:if="${signRequest.status.name() != 'draft' || user.eppn != signRequest.createBy ||  signRequest.signedDocuments.size() > 0}"]
            showRemove: false
            [/]
        }
    });

    $("#signedFiles").fileinput({
        language: "fr",
        showCaption: false,
        showClose: false,
        showUpload: false,
        showBrowse: false,
        showRemove: false,
        dropZoneEnabled: false,
        browseOnZoneClick: true,
        uploadAsync: false,
        theme: 'explorer-fas',
        pdfRendererUrl: 'http://plugins.krajee.com/pdfjs/web/viewer.html',
        initialPreview: [
        [# th:each="signedDocument : ${signRequest.signedDocuments}"]
        '/user/documents/getfile/[[${signedDocument.id}]]',
        [/]
        ],
        initialPreviewConfig: [
        [# th:each="signedDocument : ${signRequest.signedDocuments}"]
    [# th:switch="${#strings.arraySplit(signedDocument.contentType, '/')[1]}"]
        [# th:case="'pdf'"]
    {type: "pdf", size: [[${signedDocument.size}]], downloadUrl: "/user/documents/getfile/[[${signedDocument.id}]]",caption: [[${signedDocument.fileName}]], filename: [[${signedDocument.fileName}]], key: [[${signedDocument.id}]]},
        [/]
            [# th:case="*"]
    {type: "other", size: [[${signedDocument.size}]], downloadUrl: "/user/documents/getfile/[[${signedDocument.id}]]",caption: [[${signedDocument.fileName}]], filename: [[${signedDocument.fileName}]], key: [[${signedDocument.id}]]},
        [/]
            [/]
            [/]
            ],
            initialPreviewAsData: true,
            initialPreviewFileType: 'image',
            overwriteInitial: false,
            preferIconicPreview: true,
            previewFileIconSettings: { // configure your icon file extensions
        'pdf': '<i class="fas fa-file-pdf text-danger fa-2x"></i>',
            'asic': '<i class="fas fa-file-signature text-dark fa-2x"></i>',
    },
        previewFileExtSettings: { // configure the logic for determining icon file extensions
            'asic': function(ext) {
                return ext.match(/(asics|asice)$/i);
            }
        },
        fileActionSettings: {
            showDrag: false,
                showZoom: function(config) {
                if (config.type === 'pdf') {
                    return true;
                }
                return false;
            },
            showRemove: false
        }

    });
    /*]]>*/
</script>
</html>