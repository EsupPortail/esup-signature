<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="signmodal">
	<div th:if="${signable == 'ok'}">
		<form id="signForm" th:action="'/user/signrequests/sign/' + ${signRequest.id}" method="post">
							<input id="addDate" type="hidden" name="addDate" value="false">
			<div th:if="${documentType == 'pdf'}">
				<div class="row">
					<div class="col-lg-1">
						<input type="button" class="btn btn-dark" id="previous" onclick="previousImage()" value="<<" />
					</div>
					<div class="col-lg-10">
						<div class="d-flex justify-content-center">
							<div id="pointer_div" onmousedown="savePosition();" onmouseout="resetPosition();" onmousemove="pointIt(event);" th:style="'background-size: ' + ${pdfWidth} + 'px;background-image:url(\'/user/documents/' + ${documentId} + '/getimagepdfpage/' + ${signRequest.signRequestParams.signPageNumber -1} + '\');width:' + ${pdfWidth} + 'px;height:' + ${pdfHeight} + 'px;border:1px solid #CCC;pointer-events: none;'">
								<th:block th:if="${signable == 'ok' && signRequest.status.name() != 'signed' && signRequest.signRequestParams.newPageType.name() == 'none' && signRequest.signRequestParams.signType.name() != 'visa'}">
									<div onclick="dragSignature();" onmouseover="animBorder();" id="cross" th:style="'background-repeat: no-repeat; background-position: left bottom; background-size: ' + ${signWidth} + 'px;background-image: url(\'data:image/png;base64,' + ${signFile} + '\'); width: ' + ${signWidth} + 'px; height: ' + ${signHeight} + 'px; line-height: ' + ${signHeight} + 'px; text-align: center; left: ' + ${signRequest.signRequestParams.XPos} + 'px;top: ' + ${signRequest.signRequestParams.YPos} + 'px;position:relative;pointer-events: auto;cursor: move;'">
										<div id="borders" th:style="'text-align:left;line-height:normal;width: ' + ${signWidth} + 'px; height: ' + ${signHeight} + 'px;'"></div>
									</div>
								</th:block>
								<th:block th:if="${signable == 'ok' && signRequest.status.name() != 'signed' && signRequest.signRequestParams.newPageType.name() == 'none' && signRequest.signRequestParams.signType.name() == 'visa'}">
									<div onclick="dragSignature();" onmouseover="animBorder();" id="cross" th:style="'background-repeat: no-repeat; background-position: left bottom; background-size: ' + ${signWidth} + 'px;background-image: url(\'/images/sceau.png\'); width: ' + ${signWidth} + 'px; height: ' + ${signHeight} + 'px; line-height: ' + ${signHeight} + 'px; text-align: center; left: ' + ${signRequest.signRequestParams.XPos} + 'px;top: ' + ${signRequest.signRequestParams.YPos} + 'px;position:relative;pointer-events: auto;cursor: move;'">
										<div id="borders" th:style="'text-align:left;line-height:normal;width: ' + ${signWidth} + 'px; height: ' + ${signHeight} + 'px;'">
											<span style="font-size: 8px;" th:text="'Visé par ' + ${user.firstname} + ' ' + ${user.name}"></span> 
										</div>
									</div>
								</th:block>
							</div>
						</div>
					</div>
					<div class="col-lg-1">
						<input type="button" class="btn btn-dark float-right" id="next" onclick="nextImage()" value=">>" />
					</div>
					<script th:inline="javascript">
					/*<![CDATA[*/
						var zoom = 1;
						var nbImagePage = [[${imagePagesSize}]];
						var currentImagePage = [[${signRequest.signRequestParams.signPageNumber}]] - 1;
						var documentUrl = "/user/documents/[[${documentId}]]/getimagepdfpage/";
						var signId = [[${signRequest.id}]];
					/*]]>*/
					</script>
				</div>
				<div class="d-none">
					<div class="col-lg-4">
						Page : <input readonly="readonly" autocomplete="off" class="form-control form-control-sm col-6" th:value="${signRequest.signRequestParams.signPageNumber}" id="signPageNumber" type="text" name="signPageNumber" />
					</div>
					<div class="col-lg-4">
						X position : <input readonly="readonly" autocomplete="off" class="form-control form-control-sm col-6" th:value="${signRequest.signRequestParams.XPos}" id="xPos" type="text" name="xPos" />
					</div>
					<div class="col-lg-4">
						Y position : <input readonly="readonly" autocomplete="off" class="form-control form-control-sm col-6" th:value="${signRequest.signRequestParams.YPos}" id="yPos" type="text" name="yPos" />
					</div>
				</div>
			</div>
			<dl class="display-group border-bottom m-0">
				<dt class="col-lg-5">Afficher la date</dt>
				<dd>
					<label class="switch"> <input onclick="activeDate();" type="checkbox" id="_activeDate" /> <span class="slider round">
							<!--  -->
					</span>
					</label>
				</dd>
			</dl>

			<dl class="display-group border-bottom m-0">
				<dt class="col-lg-5">Commentaire</dt>
				<dd>
					<textarea placeholder="Vous pouvez ajouter un commentaire" class="form-control" name="comment" cols="" rows=""></textarea>
				</dd>
			</dl>
			<dl class="display-group border-bottom m-0">
				<dt class="col-lg-5">
					Signature
				</dt>
				<dd>
					<div th:if="${user.signImage == null && documentType == 'pdf' && signRequest.signRequestParams.signType.name() != 'visa'}">
						<div class="card card-body bg-danger text-white">
							<a href="/user/users/" class="text-white">Pas d'image de signature</a>
						</div>
					</div>
					<div th:switch="${signRequest.signRequestParams.signType.name()}">
						<div th:case="'certSign'">
							<div th:if="${keystore != null}">
								<div class="input-group">
								<div class="input-prepend">
								<span class="input-group-text" >Mot de passe</span>	
									</div>
									<input class="form-control" required="required" placeholder="Vous allez signer à l'aide d'un certificat, merci d'entrer le mot de passe" id="password" name="password" type="password" />
									<div class="input-group-append">
										<input data-toggle="modal" data-target="#wait" onclick="submitSignRequest();" alt="${signLabel}" class="btn btn-success" id="signe" title="Signe" type="button" value="Signer" />
									</div>
								</div>
							</div>
							<div th:unless="${keystore != null}">
								<div class="card card-body bg-danger text-white">
									<a href="/user/users/" class="text-white">Pas de keystore</a>
								</div>
							</div>
						</div>
						<div th:case="'nexuSign'">
							<button type="submit" class="btn btn-success" data-target="#signatureModal">
								Signer
							</button>
						</div>
						<div th:case="*">
							<div th:if="${signRequest.signRequestParams.signType.name() == 'visa'}">
								<input alt="${visaLabel}" class="btn btn-success" id="signe" title="Signe" type="submit" value="Signer" />
							</div>
							<div th:unless="${signRequest.signRequestParams.signType.name() == 'visa'}">
								<div th:if="${user.signImage != null}">
									<input alt="${signLabel}" class="btn btn-success" id="signe" title="Signe" type="submit" value="Signer" />
								</div>
							</div>
						</div>
					</div>
				</dd>
			</dl>
		</form>
	</div>
</div>
</html>