<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<!--/*@thymesVar id="logs" type="java.util.List<org.esupportail.esupsignature.entity.Log>"*/-->
<!--/*@thymesVar id="signRequest" type="org.esupportail.esupsignature.entity.SignRequest"*/-->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <base href="/">

    <link rel="stylesheet" href="/webjars/jquery-ui/1.12.1/jquery-ui.css" />
    <link rel="stylesheet" href="/webjars/bootstrap/5.1.3/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/webjars/font-awesome/5.15.2/css/all.min.css" />
    <link rel="stylesheet" href="/webjars/google-code-prettify/1.0.5/bin/prettify.min.css" />
    <link rel="stylesheet" th:href="'/css/app.css?version=' + ${version}" />

    <script src="/webjars/jquery/3.6.0/jquery.min.js"></script>
    <script src="/webjars/jquery-ui/1.12.1/jquery-ui.js"></script>
    <script src="/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="/webjars/bootbox/5.5.2/bootbox.js"></script>
    <script src="/webjars/bootbox/5.5.2/bootbox.locales.js"></script>
    <script src="/webjars/croppie/2.6.5/croppie.min.js"></script>
    <script src="/webjars/momentjs/2.29.1/moment.js"></script>
    <script src="/webjars/momentjs/2.29.1/locale/fr.js"></script>

    <link rel="icon" type="image/png" th:href="@{/images/favicon.ico}" />

    <title th:text="#{application.title}"></title>
</head>
<body>
<nav th:replace="fragments/nav-empty"></nav>
<main role="main">
    <div class="col-10 mx-auto" style="margin-top: 60px">
        <th:block th:if="${signRequest}">
            <div class="alert alert-primary mb-1">
                <h5>Contrôle de document : <span th:text="${signRequest.token}"></span></h5>
            </div>
            <th:block th:if="${signRequest.status != T(org.esupportail.esupsignature.entity.enums.SignRequestStatus).draft && signRequest.status != T(org.esupportail.esupsignature.entity.enums.SignRequestStatus).pending && signRequest.status != T(org.esupportail.esupsignature.entity.enums.SignRequestStatus).refused}">
                <div class="alert alert-success mb-1">
                    <h5>Le document a été signé par :</h5>
                    <ul th:each="userHasSigned : ${usersHasSigned}">
                        <li th:text="${userHasSigned.firstname} + ' ' + ${userHasSigned.name}"></li>
                    </ul>
                </div>
                <div class="card mb-1">
                    <div class="card-header"><h5>Informations générales sur le document</h5></div>
                    <div class="card-body">
                        <dl class="row border-bottom m-0">
                            <dt class="col-lg-5">Nom de document</dt>
                            <dd th:text="${signedDocument.fileName}"></dd>
                        </dl>
                        <dl class="row border-bottom m-0">
                            <dt class="col-lg-5">Statut du document</dt>
                            <dd>Signé</dd>
                        </dl>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h5>Actions réalisées sur le document</h5></div>
                    <div class="card-body">
                        <table class="table table-sm table-hover">
                            <thead class="table-secondary">
                            <tr>
                                <th>Date</th>
                                <th>Nom</th>
                                <th>Action</th>
                                <th>Caratéristiques de la signature</th>
                            </tr>
                            </thead>
                            <tbody>
                            <th:block th:each="log, iterator : ${logs}">
                                <tr th:if="${logs.size() > iterator.index + 1 && (logs[iterator.index + 1].finalStatus == 'checked' || logs[iterator.index + 1].finalStatus == 'signed')}">
                                    <td class="text-left"><span
                                            th:text="${#dates.format(log.logDate, 'dd/MM/yyyy HH:mm:ss')}"></span></td>
                                    <td class="text-left"><span th:text="${log.user.firstname} + ' ' + ${log.user.name}"></span></td>
                                    <td class="text-left"><span
                                            th:text="#{'signbook.status.' + ${logs[iterator.index + 1].finalStatus}}"></span></td>
                                    <td class="text-left"><span th:if="${log.action == 'Apposition de la signature'}"
                                                                th:text="'Apposition d`un visuel en page ' + ${log.pageNumber} + ' aux coordonnées (' + ${log.posX} + ', ' + ${log.posY} + ')'"></span>
                                    </td>
                                </tr>
                            </th:block>
                            </tbody>
                        </table>
                    </div>
                </div>
            </th:block>
            <th:block th:if="${signRequest.status == T(org.esupportail.esupsignature.entity.enums.SignRequestStatus).pending}">
                <div class="alert alert-warning mb-1">
                    <h5>Le document est en cours de signature</h5>
                </div>
            </th:block>
            <th:block th:if="${signRequest.status == T(org.esupportail.esupsignature.entity.enums.SignRequestStatus).refused}">
                <div class="alert alert-danger mb-1">
                    <h5>Le document a été refusé</h5>
                    <ul th:each="userHasRefused : ${usersHasRefused}">
                        <li th:text="${userHasSigned.firstname} + ' ' + ${userHasSigned.name}"></li>
                    </ul>
                </div>
            </th:block>
        </th:block>
        <th:block th:unless="${signRequest}">
            <h6>Document introuvable</h6>
        </th:block>
    </div>
</main>
<footer th:replace="fragments/footer"></footer>
</body>
</html>